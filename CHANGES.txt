Changes to znle_pyvisa.py Script - 01/28/26
==================================

1. VNA Port Configuration
   - Added CALC:PAR:PORT 1 command to explicitly set VNA to read from port 1

2. Plotting Functionality
   - Added matplotlib library for data visualization
   - Added --plot command-line flag to enable graphing
   - Plots display amplitude (dB) vs frequency (GHz)
   - Graphs are saved as PNG files (e.g., trace_plot.png) in the working directory

3. Time-Series Monitoring Mode
   - Added --monitor flag for antenna alignment mode
   - Plots amplitude vs time instead of frequency
   - Takes repeated measurements over specified duration (default: 60 seconds)
   - Monitors amplitude at a specific frequency or tracks maximum across sweep
   - Added --monitor-freq flag (default: 1 GHz)
   - Added --duration flag to set monitoring time (default: 60 seconds)
   - Added --interval flag to set measurement interval (default: 1 second)

4. Hardware Configuration Updates (01/28/26)
   - Changed default frequency range to 900-1500 MHz (NanoVNA-H4 output range)
   - Changed default measurement parameter from S21 to S11
   - Updated for new receiver configuration: external signal feeds directly to ZNLE6 port 1
   - New hardware: NanoVNA-H4 transmitter + RFSpace UWB antenna (900-12000 MHz)
   - New receiver: Pasco WA-9800a connected directly to ZNLE6 port 1

5. Usage Examples
   - Single sweep with plot: python znle_pyvisa.py --plot
   - Monitor at 1 GHz for 60 seconds: python znle_pyvisa.py --monitor --plot
   - Monitor for 2 minutes: python znle_pyvisa.py --monitor --plot --duration 120
   - Custom monitoring frequency: python znle_pyvisa.py --monitor --plot --monitor-freq 1.2e9
   - Frequent measurements: python znle_pyvisa.py --monitor --plot --interval 0.5

Dependencies Added:
   - matplotlib (installed via pip)
   - time, datetime (Python standard library)


GUI Application for ZNLE6 Control - 02/04/26
=========================================

1. Created znle_gui.py - Graphical User Interface
   - Built with tkinter for easy access to znle_pyvisa.py functionality
   - Provides user-friendly interface for spectrum analyzer control
   - Eliminates need for command-line arguments

2. GUI Features - Connection Settings
   - IP address and port configuration fields
   - Default values match instrument settings (192.168.15.90:5025)

3. GUI Features - Measurement Settings
   - Start/Stop frequency input fields (in Hz)
   - Number of sweep points configuration
   - S-parameter selection dropdown (S11, S21, S12, S22)
   - Optional sweep time setting

4. GUI Features - Operating Modes
   - "Run Frequency Mode" button: Single frequency sweep with amplitude plot
   - "Run Monitor Mode" button: Time-series monitoring at specific frequency
   - Monitor mode settings: frequency, duration (default 60s), interval (default 1s)
   - Stop button to cancel running measurements

5. GUI Features - User Interface
   - Output file selection with browse dialog
   - Real-time status display showing measurement progress
   - Countdown timer for Monitor mode (MM:SS format)
   - Thread-safe operation (GUI remains responsive during measurements)
   - Detailed error reporting with command logging

6. Desktop Integration
   - Created ZNLE6_Controller.desktop file for desktop launcher
   - Single-click access to GUI from desktop icon
   - Configured to use virtual environment Python interpreter

7. Environment Setup
   - Configured Python virtual environment (.venv)
   - Installed required dependencies: pyvisa, pyvisa-py, matplotlib
   - Updated GUI and desktop launcher to use venv Python path

8. File Organization
   - Created CSVs subdirectory for data files
   - Created Plots subdirectory for graph images
   - Updated default output paths to use organized folder structure
   - Both directories are created automatically if they don't exist

9. Monitor Mode Plot Enhancements
   - Calculate and display average amplitude over entire trace duration
   - Fixed y-axis scaling to average ± 5 dB for consistent trace comparison
   - Added average amplitude to plot title
   - Enables side-by-side comparison of different alignment configurations

10. GUI Refinements
   - Increased window size to 750x750 for better visibility
   - Fixed countdown timer display (changed to tk.Label for color support)
   - Added force display updates to ensure timer refreshes properly
   - Added debug logging for timer operation
   - Enhanced error reporting with detailed command logging
   - Redesigned output settings with separate directory pickers for CSVs and Plots
   - Simplified filename input to prevent overwriting previous datasets
   - Stop button available to cancel measurements in progress
   - Auto-opens generated plot in default image viewer after measurement completes
   - Real-time countdown timer (MM:SS format) during monitor mode
   - Default monitor frequency set to 900 MHz (center of frequency range)

11. Usage
   - Launch from desktop: Double-click "ZNLE6 Controller" icon
   - Launch from terminal: python3 znle_gui.py
   - Configure settings in GUI fields
   - Click mode button to start measurement
   - View real-time progress in status window
   - CSV files saved to: Antenna_Aligner/CSVs/
   - Plot images saved to: Antenna_Aligner/Plots/

Dependencies:
   - tkinter (Python standard library)
   - threading, subprocess, os (Python standard library)


Raspberry Pi Server Integration - 02/04/26
==========================================

1. Created pi_tcp_server.py - WebSocket + TCP Control Server
   - Dual-protocol server listening on port 8000
   - WebSocket endpoint at /ws for Flutter app communication
   - Plain TCP interface for testing and control commands
   - Handles concurrent WebSocket and TCP connections
   - Asynchronous architecture using asyncio

2. Created pi_websocket_server.py - Dedicated WebSocket Server
   - Real-time RSL (Received Signal Level) data streaming from VNA
   - Provides live signal strength updates to Flutter client
   - Command handling from Flutter app
   - Integration with PyVISA for VNA communication
   - Fallback to simulated data when VNA unavailable

3. Server Features - Command Support
   - PING/PONG for connection testing
   - STATUS command for server health checks
   - START_SWEEP command to initiate VNA measurements
   - Continuous data streaming during active sweeps
   - JSON-formatted messages for structured communication

4. Systemd Service Integration
   - Created pi_tcp_server.service for automatic server startup
   - Configured as system service with automatic restart on failure
   - RestartSec=5 for quick recovery from errors
   - Runs under sd2-group2 user with proper working directory
   - Enables headless operation on Raspberry Pi

5. Documentation
   - Created README_systemd.md with setup instructions
   - Includes service installation and management commands
   - Manual testing procedures before service deployment
   - Commands for viewing logs with journalctl

6. Flutter App Updates
   - Added WebSocket client integration in lib/vna_service.dart
   - Real-time VNA data monitoring in Flutter application
   - Enhanced connection checking for WebSocket availability
   - Two-sided UI support for azimuth/elevation control
   - IP address configuration for Pi connection

Dependencies Added:
   - websockets (Python package for WebSocket protocol)
   - asyncio (Python standard library)
   - pyvisa, pyvisa-py (for VNA instrument control)


Bug Fixes - 02/05/26
====================

1. Fixed Plot File Output Directory
   - Corrected znle_pyvisa.py to respect PLOTS_DIR environment variable
   - Plots now save to Plots directory when GUI specifies separate directories
   - Previously plots were saved to CSV directory regardless of GUI settings
   - Added os.environ.get('PLOTS_DIR') check in both monitor and frequency modes
   - Maintains backward compatibility for command-line usage (saves alongside CSV)
   - GUI-specified directory separation now works correctly for both CSVs and Plots


File Recovery from Commit Issues - 02/05/26
===========================================

1. Recovered znle_gui.py
   - File was lost in commit 49b68f4 ("whatever") on 02/04/26
   - Retrieved complete file from commit a595a1b (GUI_version01)
   - Restored all GUI functionality for VNA control
   - 404 lines of tkinter-based interface code recovered

2. Recovered CHANGES.txt Documentation
   - Lost entire "GUI Application for ZNLE6 Control - 02/04/26" section
   - Restored 83 lines of detailed change documentation
   - Recovered all 11 subsections documenting GUI features and updates
   - Retrieved from git commit history using git show

3. Recreated ZNLE6_Controller.desktop
   - Desktop launcher file existed on Desktop but not in repository
   - Copied launcher configuration to repository for version control
   - Preserves virtual environment Python path and working directory settings

4. Recreated Output Directories
   - Created CSVs/ directory for data file storage
   - Created Plots/ directory for graph image storage
   - Both directories referenced in GUI but were missing from workspace

5. Added Documentation for Raspberry Pi Server Integration
   - Documented pi_tcp_server.py and pi_websocket_server.py features
   - Added systemd service integration details
   - Recorded Flutter app WebSocket updates from 02/04/26
   - Ensured complete change history preservation


Frequency Scanner Tool and Enhancements - 02/06/26
==================================================

1. Created find_quiet_frequencies.py - RF Noise Floor Scanner
   - Scans frequency ranges to identify low-noise bands for RF transmission
   - Uses ZNLE6 VNA + Pasco WA-9800A receiver to measure background RF noise
   - Analyzes spectrum to find quiet (low-noise) frequency bands
   - Identifies bands below configurable noise threshold
   - Provides frequency recommendations for NanoVNA transmission experiments

2. Frequency Scanner Features
   - Dual frequency input modes: Center+Span or Start+Stop
   - Configurable scan parameters: points, threshold, minimum bandwidth
   - Automatic quiet band detection with configurable sensitivity
   - Statistical analysis: mean, median, min, max, standard deviation
   - Visual identification of quiet bands (highlighted in green on plots)
   - CSV export option for raw frequency vs power data
   - Comprehensive terminal output with recommendations

3. Created frequency_scanner_gui.py - GUI for Frequency Scanner
   - Graphical interface for find_quiet_frequencies.py
   - Connection settings: IP address, port, receiver port selection
   - Frequency mode toggle: Center+Span or Start+Stop
   - Quick preset buttons: 900 MHz ±100 MHz, 2.4 GHz ±100 MHz, 5 GHz ±200 MHz
   - Scan parameters: points, quiet threshold (dB), minimum bandwidth (MHz)
   - Custom filename input for organized data storage
   - Separate directory selectors for CSV and plot outputs
   - Real-time scan output display with scrollable text area
   - Help button with built-in documentation
   - Start/Stop buttons with status feedback

4. Desktop Integration
   - Created Frequency_Scanner.desktop launcher
   - Single-click access from desktop icon
   - Saved in repository at scripts/Frequency_Scanner.desktop
   - Configured with virtual environment Python interpreter
   - Proper working directory and startup settings

5. GitHub Connection and Repository Fixes
   - Set up automatic GitHub authentication using GitHub CLI (gh)
   - Configured git to use gh credentials with "gh auth setup-git"
   - Fixed corrupted git repository objects
   - Created recover_git_repo.sh script for future repository repairs
   - Recovered from empty object file errors
   - Repository now properly connected to github.com/lesmalan/Antenna_Aligner.git
   - GitHub authentication persists across system reboots

6. Monitor Mode Y-Axis Scaling Enhancement (znle_pyvisa.py)
   - Updated time-series plots to use consistent y-axis scaling
   - Y-axis now set to average ± 2.5 dB for all monitor mode measurements
   - Calculates average amplitude across entire measurement duration
   - Displays average and y-axis range in console output
   - Enables direct visual comparison between different alignment runs
   - Prevents auto-scaling from hiding small signal variations

7. Output File Management Improvements
   - Added --csv-dir, --plots-dir, --filename arguments to find_quiet_frequencies.py
   - Fixed plot/CSV saving to respect user-specified directories
   - Files now saved with custom base filename plus timestamp
   - GUI properly passes directory and filename parameters to backend script
   - Format: {filename}_{timestamp}.csv and {filename}_{timestamp}.png
   - Directories automatically created if they don't exist

8. Documentation and Change Tracking
   - Created vscode_github_commands.txt with GitHub connection instructions
   - Documented authentication setup for VS Code integration
   - Recorded all changes in CHANGES.txt following established format conventions
   - Preserved complete history of tools created and modifications made

9. Enhanced Error Reporting (frequency_scanner_gui.py)
   - Implemented comprehensive input validation with field-specific error messages
   - Added stderr capture for subprocess error handling
   - Categorized exceptions: FileNotFoundError, PermissionError, general exceptions
   - Added full traceback logging to scan output display
   - Provides examples of valid input formats in error messages
   - Validates IP address, port numbers, frequency values, and scan parameters
   - Shows specific field names and constraints when validation fails

10. Bug Fix - Missing Import Statement (find_quiet_frequencies.py)
   - Added missing "import os" at line 13
   - Fixed NameError that prevented directory creation and file operations
   - Required for os.path.join() and os.makedirs() function calls

11. Plot Enhancement - Quietest Frequency Marker
   - Added red star marker on plot to indicate quietest detected frequency
   - Marker placed at minimum power point across entire spectrum
   - Legend entry: "Quietest: {frequency} MHz at {power} dBm"
   - Provides quick visual identification of optimal transmission frequency

12. Non-Blocking Plot Display (find_quiet_frequencies.py)
   - Removed plt.show() which was blocking script execution
   - Script now completes immediately after scan finishes
   - Replaced with plt.close() to free memory resources
   - Added automatic plot opening using xdg-open subprocess
   - Plot opens in default image viewer as separate non-blocking process
   - GUI now shows "Scan complete!" message immediately
   - Enables continuous scanning operations without manual window management
   - Fixes issue where scan appeared frozen until matplotlib window was closed

Usage - Frequency Scanner:
   - Launch GUI: Double-click "Frequency Scanner" desktop icon
   - Or from terminal: python3 scripts/frequency_scanner_gui.py
   - Command line: python3 scripts/find_quiet_frequencies.py --center 900e6 --span 200e6
   - Select frequency range (presets or custom)
   - Configure scan parameters and output filename
   - Click "Start Scan" to begin measurement
   - View real-time progress and results
   - Check Plots/ directory for visual analysis
   - Use recommended frequency for NanoVNA transmission experiments

Dependencies Added:
   - numpy (for statistical analysis and array operations)
   - subprocess (Python standard library, for automatic plot opening)
   - All matplotlib and pyvisa dependencies already present from previous tools
