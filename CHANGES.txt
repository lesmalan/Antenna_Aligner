Changes to znle_pyvisa.py Script - 01/28/26
==================================

1. VNA Port Configuration
   - Added CALC:PAR:PORT 1 command to explicitly set VNA to read from port 1

2. Plotting Functionality
   - Added matplotlib library for data visualization
   - Added --plot command-line flag to enable graphing
   - Plots display amplitude (dB) vs frequency (GHz)
   - Graphs are saved as PNG files (e.g., trace_plot.png) in the working directory

3. Time-Series Monitoring Mode
   - Added --monitor flag for antenna alignment mode
   - Plots amplitude vs time instead of frequency
   - Takes repeated measurements over specified duration (default: 60 seconds)
   - Monitors amplitude at a specific frequency or tracks maximum across sweep
   - Added --monitor-freq flag (default: 1 GHz)
   - Added --duration flag to set monitoring time (default: 60 seconds)
   - Added --interval flag to set measurement interval (default: 1 second)

4. Hardware Configuration Updates (01/28/26)
   - Changed default frequency range to 900-1500 MHz (NanoVNA-H4 output range)
   - Changed default measurement parameter from S21 to S11
   - Updated for new receiver configuration: external signal feeds directly to ZNLE6 port 1
   - New hardware: NanoVNA-H4 transmitter + RFSpace UWB antenna (900-12000 MHz)
   - New receiver: Pasco WA-9800a connected directly to ZNLE6 port 1

5. Usage Examples
   - Single sweep with plot: python znle_pyvisa.py --plot
   - Monitor at 1 GHz for 60 seconds: python znle_pyvisa.py --monitor --plot
   - Monitor for 2 minutes: python znle_pyvisa.py --monitor --plot --duration 120
   - Custom monitoring frequency: python znle_pyvisa.py --monitor --plot --monitor-freq 1.2e9
   - Frequent measurements: python znle_pyvisa.py --monitor --plot --interval 0.5

Dependencies Added:
   - matplotlib (installed via pip)
   - time, datetime (Python standard library)


GUI Application for ZNLE6 Control - 02/04/26
=========================================

1. Created znle_gui.py - Graphical User Interface
   - Built with tkinter for easy access to znle_pyvisa.py functionality
   - Provides user-friendly interface for spectrum analyzer control
   - Eliminates need for command-line arguments

2. GUI Features - Connection Settings
   - IP address and port configuration fields
   - Default values match instrument settings (192.168.15.90:5025)

3. GUI Features - Measurement Settings
   - Start/Stop frequency input fields (in Hz)
   - Number of sweep points configuration
   - S-parameter selection dropdown (S11, S21, S12, S22)
   - Optional sweep time setting

4. GUI Features - Operating Modes
   - "Run Frequency Mode" button: Single frequency sweep with amplitude plot
   - "Run Monitor Mode" button: Time-series monitoring at specific frequency
   - Monitor mode settings: frequency, duration (default 60s), interval (default 1s)
   - Stop button to cancel running measurements

5. GUI Features - User Interface
   - Output file selection with browse dialog
   - Real-time status display showing measurement progress
   - Countdown timer for Monitor mode (MM:SS format)
   - Thread-safe operation (GUI remains responsive during measurements)
   - Detailed error reporting with command logging

6. Desktop Integration
   - Created ZNLE6_Controller.desktop file for desktop launcher
   - Single-click access to GUI from desktop icon
   - Configured to use virtual environment Python interpreter

7. Environment Setup
   - Configured Python virtual environment (.venv)
   - Installed required dependencies: pyvisa, pyvisa-py, matplotlib
   - Updated GUI and desktop launcher to use venv Python path

8. File Organization
   - Created CSVs subdirectory for data files
   - Created Plots subdirectory for graph images
   - Updated default output paths to use organized folder structure
   - Both directories are created automatically if they don't exist

9. Monitor Mode Plot Enhancements
   - Calculate and display average amplitude over entire trace duration
   - Fixed y-axis scaling to average Â± 5 dB for consistent trace comparison
   - Added average amplitude to plot title
   - Enables side-by-side comparison of different alignment configurations

10. GUI Refinements
   - Increased window size to 750x750 for better visibility
   - Fixed countdown timer display (changed to tk.Label for color support)
   - Added force display updates to ensure timer refreshes properly
   - Added debug logging for timer operation
   - Enhanced error reporting with detailed command logging
   - Redesigned output settings with separate directory pickers for CSVs and Plots
   - Simplified filename input to prevent overwriting previous datasets
   - Stop button available to cancel measurements in progress
   - Auto-opens generated plot in default image viewer after measurement completes
   - Real-time countdown timer (MM:SS format) during monitor mode
   - Default monitor frequency set to 900 MHz (center of frequency range)

11. Usage
   - Launch from desktop: Double-click "ZNLE6 Controller" icon
   - Launch from terminal: python3 znle_gui.py
   - Configure settings in GUI fields
   - Click mode button to start measurement
   - View real-time progress in status window
   - CSV files saved to: Antenna_Aligner/CSVs/
   - Plot images saved to: Antenna_Aligner/Plots/

Dependencies:
   - tkinter (Python standard library)
   - threading, subprocess, os (Python standard library)


Raspberry Pi Server Integration - 02/04/26
==========================================

1. Created pi_tcp_server.py - WebSocket + TCP Control Server
   - Dual-protocol server listening on port 8000
   - WebSocket endpoint at /ws for Flutter app communication
   - Plain TCP interface for testing and control commands
   - Handles concurrent WebSocket and TCP connections
   - Asynchronous architecture using asyncio

2. Created pi_websocket_server.py - Dedicated WebSocket Server
   - Real-time RSL (Received Signal Level) data streaming from VNA
   - Provides live signal strength updates to Flutter client
   - Command handling from Flutter app
   - Integration with PyVISA for VNA communication
   - Fallback to simulated data when VNA unavailable

3. Server Features - Command Support
   - PING/PONG for connection testing
   - STATUS command for server health checks
   - START_SWEEP command to initiate VNA measurements
   - Continuous data streaming during active sweeps
   - JSON-formatted messages for structured communication

4. Systemd Service Integration
   - Created pi_tcp_server.service for automatic server startup
   - Configured as system service with automatic restart on failure
   - RestartSec=5 for quick recovery from errors
   - Runs under sd2-group2 user with proper working directory
   - Enables headless operation on Raspberry Pi

5. Documentation
   - Created README_systemd.md with setup instructions
   - Includes service installation and management commands
   - Manual testing procedures before service deployment
   - Commands for viewing logs with journalctl

6. Flutter App Updates
   - Added WebSocket client integration in lib/vna_service.dart
   - Real-time VNA data monitoring in Flutter application
   - Enhanced connection checking for WebSocket availability
   - Two-sided UI support for azimuth/elevation control
   - IP address configuration for Pi connection

Dependencies Added:
   - websockets (Python package for WebSocket protocol)
   - asyncio (Python standard library)
   - pyvisa, pyvisa-py (for VNA instrument control)


Bug Fixes - 02/05/26
====================

1. Fixed Plot File Output Directory
   - Corrected znle_pyvisa.py to respect PLOTS_DIR environment variable
   - Plots now save to Plots directory when GUI specifies separate directories
   - Previously plots were saved to CSV directory regardless of GUI settings
   - Added os.environ.get('PLOTS_DIR') check in both monitor and frequency modes
   - Maintains backward compatibility for command-line usage (saves alongside CSV)
   - GUI-specified directory separation now works correctly for both CSVs and Plots


File Recovery from Commit Issues - 02/05/26
===========================================

1. Recovered znle_gui.py
   - File was lost in commit 49b68f4 ("whatever") on 02/04/26
   - Retrieved complete file from commit a595a1b (GUI_version01)
   - Restored all GUI functionality for VNA control
   - 404 lines of tkinter-based interface code recovered

2. Recovered CHANGES.txt Documentation
   - Lost entire "GUI Application for ZNLE6 Control - 02/04/26" section
   - Restored 83 lines of detailed change documentation
   - Recovered all 11 subsections documenting GUI features and updates
   - Retrieved from git commit history using git show

3. Recreated ZNLE6_Controller.desktop
   - Desktop launcher file existed on Desktop but not in repository
   - Copied launcher configuration to repository for version control
   - Preserves virtual environment Python path and working directory settings

4. Recreated Output Directories
   - Created CSVs/ directory for data file storage
   - Created Plots/ directory for graph image storage
   - Both directories referenced in GUI but were missing from workspace

5. Added Documentation for Raspberry Pi Server Integration
   - Documented pi_tcp_server.py and pi_websocket_server.py features
   - Added systemd service integration details
   - Recorded Flutter app WebSocket updates from 02/04/26
   - Ensured complete change history preservation
